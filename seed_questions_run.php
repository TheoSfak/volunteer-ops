<?php
/**
 * ONE-TIME question pool seeder — run once as system admin, then DELETE this file.
 * Access: https://yphresies.gr/seed_questions_run.php
 */
require_once __DIR__ . '/bootstrap.php';
requireRole([ROLE_SYSTEM_ADMIN]);

$pageTitle = 'Seed Ερωτήσεων Pool';

// Safety: only run if explicitly confirmed
$ran    = false;
$result = [];
$errors = [];

if (isPost() && post('confirm') === 'SEED') {
    verifyCsrf();

    // ── ensure schema is ready (same as migration 28) ────────────────────────
    $checkCol = function ($table, $col) {
        return (bool) dbFetchOne(
            "SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS
             WHERE TABLE_SCHEMA=DATABASE() AND TABLE_NAME=? AND COLUMN_NAME=?",
            [$table, $col]
        );
    };
    if (!$checkCol('training_exam_questions', 'category_id')) {
        dbExecute("ALTER TABLE training_exam_questions ADD COLUMN category_id INT UNSIGNED NULL AFTER exam_id");
    }
    if (!$checkCol('training_exam_questions', 'display_order')) {
        dbExecute("ALTER TABLE training_exam_questions ADD COLUMN display_order INT DEFAULT 0");
    }
    if (!$checkCol('training_exam_questions', 'updated_at')) {
        dbExecute("ALTER TABLE training_exam_questions ADD COLUMN updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP");
    }
    dbExecute("ALTER TABLE training_exam_questions MODIFY exam_id INT NULL");
    dbExecute("ALTER TABLE training_quiz_questions MODIFY quiz_id INT NULL");

    // ── get / create categories ──────────────────────────────────────────────
    $catPV = dbFetchValue("SELECT id FROM training_categories WHERE name LIKE '%Πρώτες Βοήθειες%' LIMIT 1");
    $catD  = dbFetchValue("SELECT id FROM training_categories WHERE name LIKE '%Διάσωση%' LIMIT 1");

    if (!$catD) {
        $catD = dbInsert(
            "INSERT INTO training_categories (name, description, is_active, display_order, created_at, updated_at) VALUES (?,?,1,4,NOW(),NOW())",
            ['Διάσωση', 'Τεχνικές διάσωσης και απεγκλωβισμού']
        );
        $result[] = "✅ Δημιουργήθηκε κατηγορία Διάσωση (id=$catD)";
    } else {
        $result[] = "ℹ️ Κατηγορία Διάσωση υπάρχει (id=$catD)";
    }
    $result[] = "ℹ️ Κατηγορία Πρώτες Βοήθειες (id=$catPV)";

    // ── helpers ───────────────────────────────────────────────────────────────
    $insExam = function ($catId, $type, $q, $a, $b, $c, $d, $correct, $exp) {
        dbInsert(
            "INSERT INTO training_exam_questions
             (category_id, exam_id, question_type, question_text, option_a, option_b, option_c, option_d, correct_option, explanation, created_at, updated_at)
             VALUES (?,NULL,?,?,?,?,?,?,?,?,NOW(),NOW())",
            [$catId, $type, $q, $a, $b, $c, $d, $correct, $exp]
        );
    };
    $insQuiz = function ($catId, $type, $q, $a, $b, $c, $d, $correct, $exp) {
        dbInsert(
            "INSERT INTO training_quiz_questions
             (category_id, quiz_id, question_type, question_text, option_a, option_b, option_c, option_d, correct_option, explanation, created_at, updated_at)
             VALUES (?,NULL,?,?,?,?,?,?,?,?,NOW(),NOW())",
            [$catId, $type, $q, $a, $b, $c, $d, $correct, $exp]
        );
    };

    // ── Πρώτες Βοήθειες — 35 MC ──────────────────────────────────────────────
    $pv_mc = [
        ["Ποιο είναι το πρώτο βήμα αξιολόγησης ενός τραυματία;","Έλεγχος αεραγωγού","Εξασφάλιση ασφάλειας σκηνής","Κλήση ασθενοφόρου","Έλεγχος σφυγμού","B","Πάντα εξασφαλίζουμε πρώτα την ασφάλεια της σκηνής για τον διασώστη."],
        ["Ποιος ρυθμός θωρακικών συμπιέσεων συνιστάται στην CPR ενηλίκων;","60-80 ανά λεπτό","80-100 ανά λεπτό","100-120 ανά λεπτό","120-140 ανά λεπτό","C","Σύμφωνα με τις κατευθυντήριες οδηγίες ERC 2021, ο ρυθμός είναι 100-120/λεπτό."],
        ["Σε ποιο βάθος πρέπει να γίνονται οι θωρακικές συμπιέσεις στον ενήλικα;","2-3 εκατοστά","3-4 εκατοστά","5-6 εκατοστά","7-8 εκατοστά","C","Το συνιστώμενο βάθος είναι 5-6 εκατοστά για αποτελεσματική CPR."],
        ["Ποια είναι η αναλογία συμπιέσεων-εμφυσήσεων στην CPR ενηλίκων;","15:2","30:2","20:2","30:1","B","Η αναλογία 30:2 ισχύει για ενήλικες από έναν ή δύο διασώστες."],
        ["Τι σημαίνει η συντομογραφία AVPU;","Alert, Voice, Pain, Unresponsive","Airway, Ventilation, Pulse, Unresponsive","Assess, Ventilate, Position, Urgent","Alert, Vital, Pulse, Unconscious","A","Το AVPU χρησιμοποιείται για γρήγορη αξιολόγηση επιπέδου συνείδησης."],
        ["Ποιο τηλέφωνο έκτακτης ανάγκης αντιστοιχεί στο ΕΚΑΒ;","112","100","166","199","C","Το 166 είναι το τηλέφωνο του ΕΚΑΒ (Εθνικό Κέντρο Άμεσης Βοήθειας)."],
        ["Σε ποια θέση τοποθετούμε έναν ασυνείδητο ασθενή που αναπνέει κανονικά;","Ύπτια","Πλάγια Ασφάλειας","Καθιστή","Ημι-ύπτια","B","Η Πλάγια Θέση Ασφάλειας (ΠΘΑ) αποτρέπει τον κίνδυνο εισρόφησης."],
        ["Ποιο είναι το βασικό σημάδι αναγνώρισης εγκεφαλικού σύμφωνα με το FAST;","Fever, Ache, Skin, Tremor","Face, Arms, Speech, Time","Fatigue, Anxiety, Stroke, Treatment","Falls, Ataxia, Seizure, Tingling","B","FAST: Face drooping, Arm weakness, Speech difficulty, Time to call."],
        ["Πώς σταματάμε μια σοβαρή αιμορραγία στα άκρα;","Ψύξη","Ανύψωση και άμεση πίεση","Τριβή","Χαλαρή βάνδα","B","Η άμεση πίεση με ανύψωση είναι η πρώτη επιλογή για αιμοστατική αγωγή."],
        ["Ποιο σημάδι δείχνει εσωτερική αιμορραγία;","Ζεστό δέρμα","Διαστολή της κόρης","Ωχρότητα και εφίδρωση","Ταχύπνοια μόνο","C","Ωχρό, κρύο και υγρό δέρμα υποδηλώνει shock από εσωτερική αιμορραγία."],
        ["Τι είναι το τουρνικέ;","Επίδεσμος για αιμορραγία φλέβας","Σφιχτό δέσιμο άκρου για αιμόσταση","Νάρθηκας","Φάρμακο για πόνο","B","Το τουρνικέ εφαρμόζεται για αιμόσταση σε σοβαρή αιμορραγία άκρου."],
        ["Ποια είναι η θεραπεία για ήπιο έγκαυμα 1ου βαθμού;","Εφαρμογή βουτύρου","Σπάσιμο φυσαλλίδων","Ψύξη με τρεχούμενο νερό 10-20 λεπτά","Κάλυψη με παχύ επίδεσμο","C","Η ψύξη με δροσερό νερό μειώνει τον πόνο και περιορίζει τη βλάβη."],
        ["Ποιο είναι το σημάδι αλλεργικής αντίδρασης (αναφυλαξίας);","Βραδυκαρδία","Κνίδωση και δύσπνοια","Υπέρταση","Υποθερμία","B","Αναφυλαξία εκδηλώνεται με κνίδωση, δύσπνοια, πτώση πίεσης κ.α."],
        ["Ποιο φάρμακο χορηγείται κατά της αναφυλαξίας;","Ασπιρίνη","Αδρεναλίνη (Επινεφρίνη)","Ινσουλίνη","Νιτρογλυκερίνη","B","Η αδρεναλίνη είναι το φάρμακο πρώτης εκλογής για αναφυλακτικό shock."],
        ["Ποιο είναι χαρακτηριστικό σύμπτωμα εμφράγματος μυοκαρδίου;","Φαγούρα","Πόνος στο στήθος που ακτινοβολεί στο αριστερό χέρι","Υψηλός πυρετός","Βήχας","B","Ο ακτινοβόλος πόνος στήθους-αριστερού βραχίονα είναι κλασικό σύμπτωμα ΑΕΜ."],
        ["Πόσο χρόνο ισχύει η τεχνητή αναπνοή στην CPR;","0.5 δευτερόλεπτα","1 δευτερόλεπτο","3 δευτερόλεπτα","5 δευτερόλεπτα","B","Κάθε εμφύσηση πρέπει να διαρκεί περίπου 1 δευτερόλεπτο."],
        ["Σε τι χρησιμεύει ο AED;","Μέτρηση πίεσης","Αποκατάσταση φυσιολογικού καρδιακού ρυθμού με ηλεκτρικό σοκ","Χορήγηση οξυγόνου","Έλεγχος σακχάρου","B","Ο AED χρησιμοποιείται για κολποκοιλιακή μαρμαρυγή."],
        ["Ποιο είναι το πρώτο βήμα πριν χρησιμοποιήσουμε AED;","Ξεκινάμε αμέσως CPR","Τοποθετούμε ηλεκτρόδια","Βεβαιωνόμαστε ότι κανείς δεν αγγίζει τον ασθενή","Ανοίγουμε τον αεραγωγό","C","Πριν το σοκ πρέπει να διασφαλίσουμε ότι κανείς δεν αγγίζει τον ασθενή."],
        ["Τι κάνουμε σε περίπτωση αποφραγμένου αεραγωγού σε ενήλικα;","Ράπισμα στο κεφάλι","Κοιλιακές ωθήσεις (Heimlich)","Θωρακικές συμπιέσεις μόνο","Τεχνητή αναπνοή","B","Η μέθοδος Heimlich είναι η ενδεδειγμένη για αποφραγμένο αεραγωγό."],
        ["Πόσο χρόνο αντέχει ο εγκέφαλος χωρίς οξυγόνο;","1-2 λεπτά","4-6 λεπτά","10-15 λεπτά","20 λεπτά","B","Μετά 4-6 λεπτά χωρίς οξυγόνο αρχίζουν μη αναστρέψιμες βλάβες."],
        ["Ποιο είναι το σύμπτωμα υπογλυκαιμίας;","Υψηλός πυρετός","Τρέμουλο, ζαλάδα, εφίδρωση","Ξηρό δέρμα","Ναυτία μόνο","B","Υπογλυκαιμία: τρέμουλο, ιδρώτας, σύγχυση, αδυναμία."],
        ["Τι δίνουμε σε συνειδητό ασθενή με υπογλυκαιμία;","Ινσουλίνη","Ζάχαρη ή γλυκό ρόφημα","Νερό μόνο","Αναλγητικά","B","Ο συνειδητός υπογλυκαιμικός χρειάζεται άμεση χορήγηση ζάχαρης."],
        ["Ποια είναι η σωστή θέση για ασθενή σε shock;","Ορθοστασία","Ύπτια με ανυψωμένα σκέλη 30°","Καθιστή","Κεφάλι ψηλά","B","Η ανύψωση σκελών βελτιώνει την κεντρική κυκλοφορία σε shock."],
        ["Πόσα ράπισμα στην πλάτη κάνουμε για αποφράξη αεραγωγού;","2","5","10","3","B","ERC: 5 ράπισμα στη μεσαία πλάτη, μετά 5 κοιλιακές ωθήσεις."],
        ["Ποια η κλίμακα Glasgow (GCS) αξιολογεί;","Πόνο","Επίπεδο συνείδησης","Πίεση αίματος","Θερμοκρασία","B","Η GCS αξιολογεί επίπεδο συνείδησης."],
        ["Ποια είναι η χαμηλότερη τιμή GCS;","1","3","5","0","B","Η ελάχιστη τιμή GCS είναι 3."],
        ["Ποιο κάταγμα θεωρείται απειλητικό για τη ζωή;","Πήχης","Κνήμης","Πυέλου","Ακτινωτού","C","Το κάταγμα πυέλου μπορεί να προκαλέσει απώλεια 3-4 λίτρων αίματος."],
        ["Πώς ακινητοποιούμε ένα κάταγμα;","Χωρίς ακινητοποίηση","Σταθεροποιούμε πάνω και κάτω άρθρωση","Μόνο κάτω άρθρωση","Μόνο πάνω άρθρωση","B","Ακινητοποίηση κατάγματος: οι δύο γειτονικές αρθρώσεις."],
        ["Ποιο είναι το σύμπτωμα shock στο κυκλοφορικό;","Βραδυκαρδία","Ταχυκαρδία με ασθενή σφυγμό","Αρτηριακή υπέρταση","Βραδύπνοια","B","Shock: ταχυκαρδία με ασθενή σφυγμό."],
        ["Ποια η πρώτη ενέργεια για έγκαυμα από χημικά;","Εφαρμογή αλοιφής","Αφαίρεση με πανί","Αφαίρεση ρούχων + πλύσιμο 20 λεπτά","Κάλυψη","C","Αφαιρούμε ρούχα και ξεπλένουμε με νερό για ≥ 20 λεπτά."],
        ["Τι κάνουμε σε υποψία τραυματισμού σπονδυλικής στήλης;","Καθιστή θέση","Inline ακινητοποίηση κεφαλής-αυχένα-κορμού","Πλάγια θέση ασφάλειας άμεσα","Περπάτημα","B","Inline ακινητοποίηση + σανίδα για τραυματισμό σπονδυλικής."],
        ["Πού τοποθετείται το τουρνικέ σε σχέση με την πληγή;","Απευθείας πάνω","5-8 εκ. πάνω","Κάτω από","Σε απόσταση 20 εκ.","B","Το τουρνικέ εφαρμόζεται 5-8 εκ. πάνω από την πληγή."],
        ["Ποιο σύμπτωμα υποδηλώνει πνευμοθώρακα;","Βραδύπνοια","Ασύμμετρη αναπνοή και απουσία αναπνευστικών ήχων","Υψηλός πυρετός","Βήχας με αίμα","B","Τάσης πνευμοθώρακας: ασύμμετρη αναπνοή, απόκλιση τραχείας."],
        ["Σε ποια κατάσταση ΔΕΝ εφαρμόζουμε CPR;","Ασθενής χωρίς αναπνοή","Ακούμε φυσιολογική αναπνοή","Ασθενής ξεκάθαρα νεκρός","Απουσία σφυγμού","C","Δεν εφαρμόζουμε CPR σε ξεκάθαρη νέκρωση."],
        ["Ποια η χρήση του EpiPen;","Υπογλυκαιμία","Αναφυλαξία","Πόνος","Εμφρακτο","B","Ο EpiPen (αυτο-έγχυση αδρεναλίνης) χρησιμοποιείται σε αναφυλαξία."],
    ];

    // ── Πρώτες Βοήθειες — 15 TF ──────────────────────────────────────────────
    $pv_tf = [
        ["Μπορούμε να χορηγήσουμε CPR σε ασθενή που αναπνέει κανονικά;","FALSE","Η CPR δίνεται ΜΟΝΟ σε απόν σφυγμό/αναπνοή."],
        ["Το AED μπορεί να χρησιμοποιηθεί από μη ιατρικό προσωπικό;","TRUE","Ο AED είναι σχεδιασμένος για χρήση από οποιονδήποτε."],
        ["Στην υποθερμία ο ασθενής εμφανίζει υψηλό πυρετό;","FALSE","Υποθερμία = θερμοκρασία σώματος κάτω από 35°C."],
        ["Σε κάταγμα ανοικτό, επαναφέρουμε το οστό στη θέση του;","FALSE","ΔΕΝ επαναφέρουμε οστά — καλύπτουμε με αποστειρωμένο επίδεσμο."],
        ["Η θέση ανάκαμψης (πλάγια ασφάλειας) χρησιμοποιείται για ασυνείδητους με αναπνοή;","TRUE","Η ΠΘΑ προλαμβάνει εισρόφηση σε ασυνείδητους που αναπνέουν."],
        ["Τα εγκαύματα 2ου βαθμού εμφανίζουν πάντα φυσαλλίδες;","TRUE","Χαρακτηριστικό εγκαυμάτων 2ου βαθμού: φυσαλλίδες."],
        ["Μπορούμε να σπάσουμε τις φυσαλλίδες εγκαύματος για ανακούφιση;","FALSE","Δεν σπάμε ποτέ φυσαλλίδες — κίνδυνος λοίμωξης."],
        ["Ο αδρεναλίνης EpiPen χρησιμοποιείται για αναφυλαξία;","TRUE","Αυτο-έγχυση αδρεναλίνης στον μηρό σε αναφυλαξία."],
        ["Σε υπογλυκαιμία ασυνείδητου ασθενή δίνουμε ζάχαρη από το στόμα;","FALSE","Σε ασυνείδητο ΔΕΝ δίνουμε τίποτα από το στόμα — κίνδυνος εισρόφησης."],
        ["Η CPR για παιδιά κάτω των 8 ετών ξεκινά με 5 εισπνοές;","TRUE","Παιδιατρική CPR: ξεκινάμε με 5 διάσωσης αναπνοές."],
        ["Σε τραύμα σπονδυλικής στήλης η πλάγια θέση ασφάλειας είναι πρώτη εκλογή;","FALSE","Η inline ακινητοποίηση είναι προτεραιότητα."],
        ["Το τουρνικέ εφαρμόζεται απευθείας πάνω στην πληγή;","FALSE","Τοποθετείται 5-8 εκ. πάνω από την πληγή."],
        ["Η εγκεφαλική ισχαιμία γίνεται μη αναστρέψιμη μετά 10 λεπτά;","FALSE","Μη αναστρέψιμη βλάβη αρχίζει από 4-6 λεπτά."],
        ["Σε πνιγμό εφαρμόζουμε CPR άμεσα μόλις εξάγουμε τον ασθενή από νερό;","TRUE","Ξεκινάμε CPR άμεσα μόλις ο ασθενής είναι σε ασφαλή επιφάνεια."],
        ["Ο AED αναλύει τον καρδιακό ρυθμό αυτόματα;","TRUE","Ο AED αναλύει αυτόματα και υποδεικνύει αν απαιτείται σοκ."],
    ];

    // ── Διάσωση — 35 MC ───────────────────────────────────────────────────────
    $d_mc = [
        ["Ποια είναι η πρώτη προτεραιότητα σε σκηνή διάσωσης;","Εντοπισμός θυμάτων","Εξασφάλιση ασφάλειας διασώστη","Κλήση ενισχύσεων","Αξιολόγηση τραυμάτων","B","Ο διασώστης πρέπει πάντα να εξασφαλίζει πρώτα τη δική του ασφάλεια."],
        ["Ποιο σύστημα χρησιμοποιείται για τη διαλογή θυμάτων (triage);","FAST","START / SALT","CPR protocol","AVPU","B","Το START είναι ευρέως χρησιμοποιούμενο σύστημα triage."],
        ["Ποιο χρώμα καρτέλας triage υποδηλώνει άμεση παρέμβαση;","Πράσινο","Κίτρινο","Κόκκινο","Μαύρο","C","Κόκκινη καρτέλα = άμεση απειλή ζωής."],
        ["Ποιο χρώμα triage σημαίνει νεκρός/μη σώσιμος;","Κόκκινο","Κίτρινο","Μαύρο","Μπλε","C","Μαύρη καρτέλα = θανών ή αναμενόμενος θάνατος."],
        ["Τι σημαίνει η αρχή LAST στη διάσωση;","Locate, Access, Stabilize, Transport","Look, Assess, Stop, Treat","Locate, Assist, Save, Transfer","Look, Alert, Stabilize, Triage","A","LAST: Εντοπισμός, Πρόσβαση, Σταθεροποίηση, Μεταφορά."],
        ["Ποια τεχνική χρησιμοποιείται για εξαγωγή από κατεστραμμένο όχημα;","Απλή έλξη","Rapid Extrication / KED vest","Απευθείας άρση","Ρυμούλκηση","B","Ο KED vest χρησιμοποιείται για ελεγχόμενη εξαγωγή τραυματία."],
        ["Πόσα άτομα χρειάζονται ελάχιστα για log roll;","1","2","3","5","C","Το log roll απαιτεί τουλάχιστον 3 διασώστες."],
        ["Σε ποια ζώνη βρίσκεται το ιατρικό επιτελείο;","Hot zone","Warm zone","Cold zone","Red zone","C","Το ιατρικό επιτελείο λειτουργεί στην Cold Zone."],
        ["Ποιο εξοπλισμό χρησιμοποιούμε για ακινητοποίηση κεφαλής-αυχένα;","Μαξιλάρι","Αυχενικός κολάρος","Σπλήνα","Γαμβάλα","B","Αυχενικός κολάρος + blocks για inline ακινητοποίηση."],
        ["Ποια η κατάλληλη θέση μεταφοράς τραυματία σπονδυλικής;","Πλάγια","Ύπτια σε σκληρή σανίδα","Ημι-ύπτια","Καθιστή","B","Σκληρή σανίδα (long spine board) για ακινητοποίηση και μεταφορά."],
        ["Τι είναι το ICS;","Σύστημα πρωτοκολλόου CPR","Σύστημα διοίκησης συμβάντος","Κωδικός ασθενοφόρου","Πρωτόκολλο εκκένωσης","B","ICS παρέχει οργανωτική δομή για διαχείριση συμβάντων."],
        ["Ποιος είναι ο ελάχιστος αριθμός ατόμων για μεταφορά με χειρολαβές;","1","2","4","6","C","Ασφαλής μεταφορά με χειρολαβές: τουλάχιστον 4 άτομα."],
        ["Πότε χρησιμοποιούμε scoop stretcher;","Μόνο σε εγκαύματα","Ανύψωση χωρίς log roll σε πιθανό τραυματισμό σπονδυλικής","Μόνο σε παιδιά","Σε σκάλες","B","Scoop stretcher: τοποθετείται χωρίς κύλιση ασθενούς."],
        ["Ποιο εξοπλισμό φοράμε σε χώρο με επικίνδυνα υλικά;","Απλή στολή","Πλήρης ΧΒΡΠ εξοπλισμός","Γάντια μόνο","Κράνος μόνο","B","Σε ΧΒΡΠ περιβάλλον: ολοκληρωμένος ΧΒΡΠ εξοπλισμός."],
        ["Σε κατάρρευση κτιρίου, ποια τεχνική αναζήτησης χρησιμοποιείται πρώτα;","Μηχανική","Οπτική & φωνητική ανίχνευση","Σκύλοι","Κάμερες","B","Πρώτα: οπτική επιθεώρηση και φωνητική επικοινωνία."],
        ["Ποια η ορθή τεχνική ανύψωσης τραυματία από έδαφος;","Κύρτωμα πλάτης","Γόνατα λυγισμένα, πλάτη ίσια","Περιστροφή κορμού","Μονόχειρη","B","Λυγισμένα γόνατα + ίσια πλάτη προλαμβάνει τραυματισμό διασώστη."],
        ["Σε διάσωση από νερό, ποια μέθοδος προτείνεται πρώτα;","Άμεση κολύμβηση","Reach - throw - row - go","Εναέρια διάσωση","Σκάφος πρώτα","B","Reach, throw, row, go: μεγιστοποιεί ασφάλεια διασώστη."],
        ["Τι είναι το 'golden hour' στη διάσωση;","Πρώτη ώρα μετά ατύχημα για κρίσιμες παρεμβάσεις","Ωράριο εκπαίδευσης","Ώρα αντικατάστασης ομάδας","Διάστημα CPR","A","Η 'χρυσή ώρα' = κρίσιμο παράθυρο σωτήριας ιατρικής παρέμβασης."],
        ["Ποιο ζωτικό σημείο ελέγχουμε πρώτο στο primary survey;","Θερμοκρασία","Σφυγμός","Αεραγωγός","Συνείδηση","C","A (Airway) είναι πάντα πρώτο στο ABCDE πρωτόκολλο."],
        ["Πόση ώρα αντέχει θύμα εγκλωβισμένο χωρίς νερό;","12 ώρες","24 ώρες","3 ημέρες","7 ημέρες","C","Ανθρώπινος οργανισμός αντέχει κατά μέσο όρο 3 ημέρες χωρίς νερό."],
        ["Ποιο εξοπλισμό φοράμε για ατομική προστασία κατά πτώσης;","Σχοινί","Ζώνη πτώσης (harness)","Κράνος","Γάντια","B","Harness ασφαλείας σε εργασία σε ύψος ή χαράδρα."],
        ["Ποια τεχνική αεροπορικής διάσωσης χρησιμοποιείται σε θαλάσσιο περιβάλλον;","Max winch","Hoist rescue","Rappel","HAHO","B","Hoist rescue για θαλάσσιες διασώσεις."],
        ["Ποιο σήμα χεριού σημαίνει 'ΣΤΑΜΑΤΑ';","Χέρι ανοιχτό εμπρός","Αντίχειρας πάνω","Κλειστή γροθιά","Χέρι κάτω","A","Ανοιχτό χέρι εμπρός = ΣΤΑΜΑ."],
        ["Σε σεισμό, ποιο είναι το κύριο αίτιο θανάτου;","Πλημμύρα","Θερμοπληξία","Εγκλωβισμός/συντριβή από κτίριο","Δηλητηρίαση","C","Η συντριβή από κατεδαφισμένες κατασκευές προκαλεί τους περισσότερους θανάτους."],
        ["Τι είναι η εκκένωση PACE;","Primary, Alternate, Contingency, Emergency","Protect, Assess, Control, Execute","Plan, Act, Communicate, Evaluate","Prepare, Alert, Check, Escape","A","PACE: τέσσερα επίπεδα σχεδίου εκκένωσης."],
        ["Σε πυρκαγιά κτιρίου πώς κινούμαστε;","Όρθιοι γρήγορα","Χαμηλά και ενάντια καπνού","Ανεμόπλευρα","Με την πλάτη στο παράθυρο","B","Κινούμαστε χαμηλά για να αποφύγουμε εισπνοή καπνού."],
        ["Τι εξοπλισμό για εξαγωγή θύματος από στενό άνοιγμα;","Φορείο","Υδραυλικό εξοπλισμό (spreader/ψαλίδι)","Τεντωτήρας","Κλίμακα","B","Υδραυλικός εξοπλισμός (spreader, ψαλίδι) για εξαγωγή."],
        ["Ποιο μέσο επικοινωνίας είναι πρωτεύον στη σκηνή;","Κινητό","Walkie-talkie / UHF ραδιοσυχνότητα","Internet","Φωνή","B","Ο ασύρματος UHF/VHF για αξιόπιστη επικοινωνία στη σκηνή."],
        ["Ποια η χρήση του reflective triangle;","Φωτισμός","Σήμανση επικίνδυνης ζώνης","Ανάκλαση ήλιου","Σκίαση","B","Σηματοδοτεί επικίνδυνη ζώνη σε οδικά ατυχήματα."],
        ["Τι είναι η τριγωνική μέθοδος αναζήτησης;","Αναζήτηση σε τριγωνικές περιοχές","Συστηματική κάλυψη εδάφους (sector)","Εκκένωση","Τεχνική ΠΒ","B","Sector μέθοδος: διασφαλίζει συστηματική κάλυψη χώρου."],
        ["Ο κανόνας 2-in/2-out σημαίνει;","2 διασώστες μπαίνουν, 2 παραμένουν εκτός","2 ώρες μέσα, 2 εκτός","2 ομάδες ταυτόχρονα","2 εξόδους ανά σκηνή","A","Εξασφαλίζει υποστήριξη σε επικίνδυνο χώρο."],
        ["Στο triage, τραυματίας που περπατά ταξινομείται ως;","Κόκκινος","Κίτρινος","Πράσινος","Μαύρος","C","Walking wounded = πράσινη κατηγορία."],
        ["Ποιο εξοπλισμό για lowering system σε κεκλιμένο έδαφος;","Ελικόπτερο","Σύστημα σχοινιών lowering","Απλό σχοινί","Κλίμακα","B","Lowering system: ελεγχόμενη κατάβαση σε κεκλιμένα εδάφη."],
        ["Ποια είναι η διαφορά σανίδας (backboard) από φορείο;","Δεν υπάρχει","Η σανίδα παρέχει inline ακινητοποίηση, το φορείο όχι","Το φορείο είναι σκληρό","Η σανίδα είναι για νερό","B","Σκληρή σανίδα = spinal immobilization, φορείο = μεταφορά."],
        ["Τι κάνουμε πρώτα σε ατύχημα με πολλά θύματα;","CPR σε πρώτο θύμα","Εφαρμόζουμε triage","Καλούμε ενισχύσεις μόνο","Φεύγουμε","B","Η διαλογή (triage) είναι το πρώτο βήμα σε MCI."],
    ];

    // ── Διάσωση — 15 TF ───────────────────────────────────────────────────────
    $d_tf = [
        ["Σε χώρο ΧΒΡΠ, μπαίνουμε χωρίς εξοπλισμό αν υπάρχει τραυματίας;","FALSE","Ποτέ hot zone χωρίς κατάλληλο εξοπλισμό."],
        ["Η κόκκινη καρτέλα triage χρησιμοποιείται για θανόντες;","FALSE","Μαύρη = θανόντες. Κόκκινη = άμεσα επείγοντες."],
        ["Ο scoop stretcher επιτρέπει ανύψωση χωρίς κύλιση ασθενούς;","TRUE","Τοποθετείται κατά μήκος χωρίς να γυρίσουμε τον ασθενή."],
        ["Σε deep water rescue ο διασώστης μπαίνει πάντα πρώτος στο νερό;","FALSE","Αρχή reach-throw-row-go: ξεκινάμε χωρίς άμεση είσοδο."],
        ["Το ICS χρησιμοποιείται μόνο σε μαζικά ατυχήματα;","FALSE","Εφαρμόζεται σε κάθε συμβάν, μικρό ή μεγάλο."],
        ["Σε κατάρρευση κτιρίου, η πρώτη φάση αναζήτησης είναι πάντα με σκύλα;","FALSE","Πρώτη φάση: οπτική και φωνητική ανίχνευση."],
        ["Το harness ασφαλείας πρέπει να ελέγχεται πριν κάθε χρήση;","TRUE","Πάντα επιθεώρηση πριν χρήση."],
        ["Σε πυρκαγιά κτιρίου χρησιμοποιούμε ασανσέρ για εκκένωση;","FALSE","Κατά εκκένωση από πυρκαγιά: ΠΟΤΕ ασανσέρ."],
        ["Ο κανόνας 2-in/2-out εξασφαλίζει αποθεματική υποστήριξη;","TRUE","Δύο διασώστες εκτός είναι έτοιμοι να βοηθήσουν εάν χρειαστεί."],
        ["Σε ανάσυρση από νερό η CPR ξεκινά πριν εξαχθεί ο ασθενής;","FALSE","CPR μόλις ο ασθενής είναι σε ασφαλή επιφάνεια εκτός νερού."],
        ["Στο triage, τραυματίας που περπατά ταξινομείται ως πράσινος;","TRUE","Walking wounded = πράσινη κατηγορία triage."],
        ["Σε σεισμό ο μεγαλύτερος κίνδυνος μετά τον κύριο σεισμό είναι ο μετασεισμός;","TRUE","Μετασεισμοί μπορεί να προκαλέσουν περαιτέρω κατάρρευση."],
        ["Το KED vest χρησιμοποιείται μόνο σε ατυχήματα πλοίων;","FALSE","KED: κυρίως για εξαγωγή τραυματία από όχημα."],
        ["Σε hot zone εργασία η επικοινωνία γίνεται ΜΟΝΟ με χειρονομίες;","FALSE","Walkie-talkie + χειρονομίες — φωνή συχνά δεν ακούγεται."],
        ["Το log roll απαιτεί τουλάχιστον 3 διασώστες;","TRUE","3 διασώστες για ασφαλή στροφή 90° του τραυματία."],
    ];

    // ── Insert ────────────────────────────────────────────────────────────────
    $counts = ['exam_pv' => 0, 'exam_d' => 0, 'quiz_pv' => 0, 'quiz_d' => 0];

    db()->beginTransaction();
    try {
        foreach ($pv_mc as $q) {
            $insExam($catPV, 'MULTIPLE_CHOICE', $q[0], $q[1], $q[2], $q[3], $q[4], $q[5], $q[6]);
            $counts['exam_pv']++;
        }
        foreach ($pv_tf as $t) {
            $insExam($catPV, 'TRUE_FALSE', $t[0], null, null, null, null, $t[1], $t[2]);
            $counts['exam_pv']++;
        }
        foreach ($d_mc as $q) {
            $insExam($catD, 'MULTIPLE_CHOICE', $q[0], $q[1], $q[2], $q[3], $q[4], $q[5], $q[6]);
            $counts['exam_d']++;
        }
        foreach ($d_tf as $t) {
            $insExam($catD, 'TRUE_FALSE', $t[0], null, null, null, null, $t[1], $t[2]);
            $counts['exam_d']++;
        }
        foreach ($pv_mc as $q) {
            $insQuiz($catPV, 'MULTIPLE_CHOICE', $q[0], $q[1], $q[2], $q[3], $q[4], $q[5], $q[6]);
            $counts['quiz_pv']++;
        }
        foreach ($pv_tf as $t) {
            $insQuiz($catPV, 'TRUE_FALSE', $t[0], null, null, null, null, $t[1], $t[2]);
            $counts['quiz_pv']++;
        }
        foreach ($d_mc as $q) {
            $insQuiz($catD, 'MULTIPLE_CHOICE', $q[0], $q[1], $q[2], $q[3], $q[4], $q[5], $q[6]);
            $counts['quiz_d']++;
        }
        foreach ($d_tf as $t) {
            $insQuiz($catD, 'TRUE_FALSE', $t[0], null, null, null, null, $t[1], $t[2]);
            $counts['quiz_d']++;
        }
        db()->commit();
        $ran = true;
        logAudit('seed_questions', 'training_exam_questions', null, 'Seed 200 ερωτήσεων pool');
    } catch (Exception $e) {
        db()->rollBack();
        $errors[] = $e->getMessage();
    }
}

include __DIR__ . '/includes/header.php';
?>
<div class="container" style="max-width:700px">
    <h2 class="mb-4"><i class="bi bi-collection me-2"></i>Seed Ερωτήσεων Pool</h2>

    <?php if ($ran): ?>
        <div class="alert alert-success">
            <h5>✅ Εισήχθησαν επιτυχώς!</h5>
            <ul class="mb-0">
                <?php foreach ($result as $r): ?>
                    <li><?= h($r) ?></li>
                <?php endforeach; ?>
                <li>Exam — Πρώτες Βοήθειες: 50 ερωτήσεις</li>
                <li>Exam — Διάσωση: 50 ερωτήσεις</li>
                <li>Quiz — Πρώτες Βοήθειες: 50 ερωτήσεις</li>
                <li>Quiz — Διάσωση: 50 ερωτήσεις</li>
            </ul>
            <hr>
            <strong class="text-danger">⚠️ Διαγράψτε το αρχείο seed_questions_run.php από τον server τώρα!</strong>
        </div>
        <a href="questions-pool.php" class="btn btn-primary">Πήγαινε στο Pool Ερωτήσεων</a>
    <?php elseif (!empty($errors)): ?>
        <div class="alert alert-danger">
            <strong>Σφάλμα:</strong><br>
            <?php foreach ($errors as $e): ?><?= h($e) ?><br><?php endforeach; ?>
        </div>
    <?php else: ?>
        <?php foreach ($result as $r): ?>
            <div class="alert alert-info py-2"><?= h($r) ?></div>
        <?php endforeach; ?>
        <div class="card border-warning mb-4">
            <div class="card-body">
                <h5>⚠️ Θα εισαχθούν 200 ερωτήσεις στο pool</h5>
                <ul>
                    <li>50 exam ερωτήσεις — Πρώτες Βοήθειες (35 MC + 15 TF)</li>
                    <li>50 exam ερωτήσεις — Διάσωση (35 MC + 15 TF)</li>
                    <li>50 quiz ερωτήσεις — Πρώτες Βοήθειες (35 MC + 15 TF)</li>
                    <li>50 quiz ερωτήσεις — Διάσωση (35 MC + 15 TF)</li>
                </ul>
                <p class="text-muted mb-0">Οι ερωτήσεις θα μπουν χωρίς ανάθεση σε exam/quiz (pool only).</p>
            </div>
        </div>
        <form method="post">
            <?= csrfField() ?>
            <div class="mb-3">
                <label class="form-label fw-semibold">Πληκτρολογήστε <code>SEED</code> για επιβεβαίωση:</label>
                <input type="text" class="form-control" name="confirm" id="confirmInput" autocomplete="off" placeholder="SEED">
            </div>
            <button type="submit" class="btn btn-warning" id="seedBtn" disabled>
                <i class="bi bi-database-fill-add me-1"></i>Εκτέλεση Seed
            </button>
            <a href="settings.php" class="btn btn-secondary ms-2">Άκυρο</a>
        </form>
        <script>
        document.getElementById('confirmInput').addEventListener('input', function() {
            document.getElementById('seedBtn').disabled = (this.value !== 'SEED');
        });
        </script>
    <?php endif; ?>
</div>
<?php include __DIR__ . '/includes/footer.php'; ?>
